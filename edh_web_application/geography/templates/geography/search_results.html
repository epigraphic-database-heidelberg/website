{% extends 'base.html' %}

{% block header %}
{% block title %}EDH: {{ title }} {% endblock %}
{% endblock %}

{% block app_content %}
<h1>{{ title }}</h1>
<h2>{{ subtitle }}</h2>
<p>{{_("The search for:")}}</p>
<p style="margin-left: 2rem;">{% for param in data['metadata']['query_params'] %}<strong>{{ _(param) }}</strong>: {{ data['metadata']['query_params'][param] }}<br />{% endfor %}</p>
<p>{{_("resulted in")}} {{number_of_hits}} {{_("hits.")}}</p>

<div class="search-filter" style="text-align:right">
    <button type="button" class="btn btn-info" id="sort-by">{{_('sort by')}}: {{_(request.args.get('sort'))}}</button>
    <button type="button" class="btn btn-info" id="hits-per-page">{{_('number of results/page')}}: {{data['metadata']['rows']}}</button>
    <button type="button" class="btn btn-info" id="view">{{_('view')}}: {{_('list')}}</button>
    <button type="button" class="btn btn-info" id="filter">{{_('filter')}}</button>
</div>

<div style="text-align:center">
    <nav aria-label="Search results pages">

        {% if number_of_hits|int / data['metadata']['rows']|int  >= 5 %}

        {% else %}

        {% endif %}

        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="page-link" href="
                    {% if (data['metadata']['start']|int - data['metadata']['rows']|int) > 0 %}
                        .{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']|int - data['metadata']['rows']|int }}&anzahl={{data['metadata']['rows']}}
                    {% else %}
                        .{{data['metadata']['url_without_pagination_parameters']}}&start=0&anzahl={{data['metadata']['rows']}}
                    {% endif %}
                    " aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
            {% for hit in range((data['metadata']['number_of_hits']|int / data['metadata']['rows'])|int + 1) %}
            {% if (data['metadata']['start']|int ) / data['metadata']['rows']|int == hit %}
            <li class="page-item disabled">
                <a class="page-link" href="#">{{ hit + 1 }}</a>
            </li>
            {% else %}
            <li class="page-item">
                <a class="page-link" href=".{{data['metadata']['url_without_pagination_parameters']}}&start={{ hit * data['metadata']['rows'] }}&anzahl={{data['metadata']['rows']}}">{{ hit + 1 }}</a>
            </li>
            {% endif %}
            {% endfor%}
            <li class="page-item">
                <a class="page-link" href="
                {% if (data['metadata']['start']|int + data['metadata']['rows']|int) <= data['metadata']['number_of_hits']|int %}
                    .{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']|int + data['metadata']['rows']|int }}&anzahl={{data['metadata']['rows']}}
                {% endif %}
                " aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                </a>
            </li>
        </ul>
    </nav>
</div>
<div>
    {% set count = namespace(value=0) %}
    {% for d in data['items'] %}
    {% set count.value = count.value + 1 %}
    <div class="detail_block">
        <div class="wrapper_geo_last_updates" style="padding:10px">
            <a href="./edh/geographie/{{ d['id'] }}" style="color:#fff"><div class="col-pixel-width-100 rotate" style="display: inline-block; vertical-align: top;">{{_('Number')}} &nbsp; {{count.value + data['metadata']['start']|int}}</div></a>
            <div class="map_geo_last_updates" style="display: inline-block; vertical-align: top;">
                <a href="./edh/geographie/{{ d['id'] }}">
                    <div id="map_canvas_{{ count.value }}" class="map_canvas"></div>
                </a>
            </div>
            <div class="detail_block_content" style="display: inline-block; vertical-align: top;">
                <section class="detail_block_content_row"><p style="text-align:center; border-bottom: 1px solid #ddd; font-size:1.2em;"><a href="./edh/geographie/{{ d['id'] }}">{{ d['id'] }} {{ _('&ndash; open detailed view...') }}</a></p>
                </section>
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('province') }}:</div>
                    <div class="detail_block_content_row_text"><a href="./edh/geographie/{{ d['provinz_id'] }}">{{ d['provinz'] }}</a></div>
                </section>
                {% if d['land'] %}
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('country') }}:</div>
                    <div class="detail_block_content_row_text">{{ d['land'] }}</div>
                </section>
                {% endif %}
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('ancient find spot') }}:</div>
                    <div class="detail_block_content_row_text">{% if d['fo_antik'] %}{{ d['fo_antik'] }}{% else %}&nbsp;{% endif %}</div>
                </section>
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('modern find spot') }}:</div>
                    <div class="detail_block_content_row_text">{% if d['fo_modern'] %}{{ d['fo_modern'] }}{% else %}&nbsp;{% endif %}</div>
                </section>
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('find spot') }}:</div>
                    <div class="detail_block_content_row_text">
                        {% if d['fundstelle'] %}
                            {{d['fundstelle']|replace("{","<span style='color:red'>")|replace("}","</span>")|safe}}
                        {% else %}
                            &nbsp;
                        {% endif %}
                    </div>
                </section>
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('verw_bezirk') }}:</div>
                    <div class="detail_block_content_row_text">
                        {% if d['verw_bezirk'] %}
                            {{ d['verw_bezirk'] }}
                        {% else %}
                            &nbsp;
                        {% endif %}
                    </div>
                </section>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<div style="text-align:center">
    <nav aria-label="Search results pages">
        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="page-link" href="
                    {% if (data['metadata']['start']|int - data['metadata']['rows']|int) > 0 %}
                        .{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']|int - data['metadata']['rows']|int }}&anzahl={{data['metadata']['rows']}}
                    {% else %}
                        .{{data['metadata']['url_without_pagination_parameters']}}&start=0&anzahl={{data['metadata']['rows']}}
                    {% endif %}
                    " aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
            {% for hit in range((data['metadata']['number_of_hits']|int / data['metadata']['rows'])|int + 1) %}
            {% if (data['metadata']['start']|int ) / data['metadata']['rows']|int == hit %}
            <li class="page-item disabled">
                <a class="page-link" href="#">{{ hit + 1 }}</a>
            </li>
            {% else %}
            <li class="page-item">
                <a class="page-link" href=".{{data['metadata']['url_without_pagination_parameters']}}&start={{ hit * data['metadata']['rows'] }}&anzahl={{data['metadata']['rows']}}">{{ hit + 1 }}</a>
            </li>
            {% endif %}
            {% endfor%}
            <li class="page-item">
                <a class="page-link" href="
                {% if (data['metadata']['start']|int + data['metadata']['rows']|int) <= data['metadata']['number_of_hits']|int %}
                    .{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']|int + data['metadata']['rows']|int }}&anzahl={{data['metadata']['rows']}}
                {% endif %}
                " aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                </a>
            </li>
        </ul>
    </nav>
</div>
<div id="dialog-sort" title = "{{_('sort by')}}:">
    <ul>
    <li><a href=".{{data['metadata']['url_without_sort_parameter']}}&start={{data['metadata']['start']}}&anzahl={{data['metadata']['rows']}}&sort=geo_id">Geo-ID</a></li>
    <li><a href=".{{data['metadata']['url_without_sort_parameter']}}&start={{data['metadata']['start']}}&anzahl={{data['metadata']['rows']}}&sort=provinz">{{_('province')}}</a></li>
    <li><a href=".{{data['metadata']['url_without_sort_parameter']}}&start={{data['metadata']['start']}}&anzahl={{data['metadata']['rows']}}&sort=land">{{_('country')}}</a></li>
    <li><a href=".{{data['metadata']['url_without_sort_parameter']}}&start={{data['metadata']['start']}}&anzahl={{data['metadata']['rows']}}&sort=fo_antik">{{_('ancient find spot')}}</a></li>
    <li><a href=".{{data['metadata']['url_without_sort_parameter']}}&start={{data['metadata']['start']}}&anzahl={{data['metadata']['rows']}}&sort=fo_modern">{{_('modern find spot')}}</a></li>
    <li><a href=".{{data['metadata']['url_without_sort_parameter']}}&start={{data['metadata']['start']}}&anzahl={{data['metadata']['rows']}}&sort=fundstelle">{{_('find spot')}}</a></li>
    <li><a href=".{{data['metadata']['url_without_sort_parameter']}}&start={{data['metadata']['start']}}&anzahl={{data['metadata']['rows']}}&sort=verw_bezirk">{{_('verw_bezirk')}}</a></li>
    </ul>
</div>
<div id="dialog-number" title = "{{_('number of results/page')}}:">
    <ul>
    <li><a href=".{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']}}&anzahl=20">20</a></li>
    <li><a href=".{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']}}&anzahl=50">50</a></li>
    <li><a href=".{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']}}&anzahl=100">100</a></li>
    <li><a href=".{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']}}&anzahl=200">200</a></li>
    </ul>
</div>
<div id="dialog-view" title = "{{_('view')}}:">
    <ul>
    <li><a href=".{{data['metadata']['url_without_view_parameter']}}&start={{data['metadata']['start']}}&view=list">{{_('list')}}</a></li>
    <li><a href=".{{data['metadata']['url_without_view_parameter']}}&start={{data['metadata']['start']}}&view=table">{{_('table')}}</a></li>
    <li><a href=".{{data['metadata']['url_without_view_parameter']}}&start={{data['metadata']['start']}}&view=map">{{_('map')}}</a></li>
    </ul>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.12/css/bootstrap-select.min.css" integrity="sha256-l3FykDBm9+58ZcJJtzcFvWjBZNJO40HmvebhpHXEhC0=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.12/js/bootstrap-select.min.js" integrity="sha256-+o/X+QCcfTkES5MroTdNL5zrLNGb3i4dYdWPWuq6whY=" crossorigin="anonymous"></script>
<script>
    {% set count = namespace(value=0) %}
    {% for d in data['items'] %}
        {% set count.value = count.value + 1 %}
        {% if d['koordinaten_1'] %}
            var pelagiosMap = L.tileLayer('https://dh.gu.se/tiles/imperium/{z}/{x}/{y}.png');
            var map = L.map('map_canvas_{{count.value}}', {
                center: [{{d['koordinaten_1']}}],
                zoom: 4,
                zoomControl:false,
                layers: [pelagiosMap]
            });
            map.dragging.disable();
            map.touchZoom.disable();
            map.doubleClickZoom.disable();
            map.scrollWheelZoom.disable();
            map.keyboard.disable();
            var marker{{count.value}} = L.marker([{{d['koordinaten_1']}}]).addTo(map);
        {% endif %}
    {% endfor %}
    $('select').selectpicker();
    $(function() {
        $( "#dialog-sort" ).dialog({
           autoOpen: false,
        });
        $( "#sort-by" ).click(function() {
           $( "#dialog-sort" ).dialog( "open" );
        });
        $( "#dialog-number" ).dialog({
           autoOpen: false,
        });
        $( "#hits-per-page" ).click(function() {
           $( "#dialog-number" ).dialog( "open" );
        });
        $( "#dialog-view" ).dialog({
           autoOpen: false,
        });
        $( "#view" ).click(function() {
           $( "#dialog-view" ).dialog( "open" );
        });
     });

</script>
{% endblock %}