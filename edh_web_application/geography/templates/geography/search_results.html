{% extends 'base.html' %}

{% block header %}
{% block title %}EDH: {{ title }} {% endblock %}
{% endblock %}

{% block app_content %}
<h1>{{ title }}</h1>
<p>{{_("The search resulted in ")}} {{number_of_hits}} {{_("hits.")}}</p>
<div style="text-align:center">
    <nav aria-label="Search results pages">
        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="page-link" href="
                    {% if (data['metadata']['start']|int - data['metadata']['rows']|int) > 0 %}
                        .{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']|int - data['metadata']['rows']|int }}&anzahl={{data['metadata']['rows']}}
                    {% else %}
                        .{{data['metadata']['url_without_pagination_parameters']}}&start=0&anzahl={{data['metadata']['rows']}}
                    {% endif %}
                    " aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
            {% for hit in range((data['metadata']['number_of_hits']|int / data['metadata']['rows'])|int + 1) %}
            {% if (data['metadata']['start']|int ) / data['metadata']['rows']|int == hit %}
            <li class="page-item disabled">
                <a class="page-link" href="#">{{ hit + 1 }}</a>
            </li>
            {% else %}
            <li class="page-item">
                <a class="page-link" href=".{{data['metadata']['url_without_pagination_parameters']}}&start={{ hit * data['metadata']['rows'] }}&anzahl={{data['metadata']['rows']}}">{{ hit + 1 }}</a>
            </li>
            {% endif %}
            {% endfor%}
            <li class="page-item">
                <a class="page-link" href="
                {% if (data['metadata']['start']|int + data['metadata']['rows']|int) <= data['metadata']['number_of_hits']|int %}
                    .{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']|int + data['metadata']['rows']|int }}&anzahl={{data['metadata']['rows']}}
                {% endif %}
                " aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                </a>
            </li>
        </ul>
    </nav>
</div>
<div>
    {% set count = namespace(value=0) %}
    {% for d in data['items'] %}
    {% set count.value = count.value + 1 %}
    <div class="detail_block">
        <div class="detail_block_header">
            <span class="detail_block_header_text"><a href="./edh/geographie/{{ d['id'] }}">{{_('Number')}} {{count.value + data['metadata']['start']|int}}: {{ d['id'] }} {{ _('&ndash; open detailed view...') }}</a></span>
        </div>
        <div class="wrapper_geo_last_updates" style="padding:10px">
            <div class="map_geo_last_updates" style="display: inline-block; vertical-align: top;">
                <a href="./edh/geographie/{{ d['id'] }}">
                    <div id="map_canvas_{{ count.value }}" style="width:200px;height:200px;border: 1px solid #ccc"></div>
                </a>
            </div>
            <div class="detail_block_content" style="display: inline-block; vertical-align: top;">
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('province') }}:</div>
                    <div class="detail_block_content_row_text">{{ d['provinz'] }}</div>
                </section>
                {% if d['land'] %}
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('country') }}:</div>
                    <div class="detail_block_content_row_text">{{ d['land'] }}</div>
                </section>
                {% endif %}
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('ancient find spot') }}:</div>
                    <div class="detail_block_content_row_text">{% if d['fo_antik'] %}{{ d['fo_antik'] }}{% else %}&nbsp;{% endif %}</div>
                </section>
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('modern find spot') }}:</div>
                    <div class="detail_block_content_row_text">{% if d['fo_modern'] %}{{ d['fo_modern'] }}{% else %}&nbsp;{% endif %}</div>
                </section>
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('find spot') }}:</div>
                    <div class="detail_block_content_row_text">
                        {% if d['fundstelle'] %}
                            {{d['fundstelle']|replace("{","<span style='color:red'>")|replace("}","</span>")|safe}}
                        {% else %}
                            &nbsp;
                        {% endif %}
                    </div>
                </section>
                <section class="detail_block_content_row">
                    <div class="detail_block_content_row_header">{{ _('verw_bezirk') }}:</div>
                    <div class="detail_block_content_row_text">
                        {% if d['verw_bezirk'] %}
                            {{ d['verw_bezirk'] }}
                        {% else %}
                            &nbsp;
                        {% endif %}
                    </div>
                </section>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<div style="text-align:center">
    <nav aria-label="Search results pages">
        <ul class="pagination justify-content-center">
            <li class="page-item">
                <a class="page-link" href="
                    {% if (data['metadata']['start']|int - data['metadata']['rows']|int) > 0 %}
                        .{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']|int - data['metadata']['rows']|int }}&anzahl={{data['metadata']['rows']}}
                    {% else %}
                        .{{data['metadata']['url_without_pagination_parameters']}}&start=0&anzahl={{data['metadata']['rows']}}
                    {% endif %}
                    " aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    <span class="sr-only">Previous</span>
                </a>
            </li>
            {% for hit in range((data['metadata']['number_of_hits']|int / data['metadata']['rows'])|int + 1) %}
            {% if (data['metadata']['start']|int ) / data['metadata']['rows']|int == hit %}
            <li class="page-item disabled">
                <a class="page-link" href="#">{{ hit + 1 }}</a>
            </li>
            {% else %}
            <li class="page-item">
                <a class="page-link" href=".{{data['metadata']['url_without_pagination_parameters']}}&start={{ hit * data['metadata']['rows'] }}&anzahl={{data['metadata']['rows']}}">{{ hit + 1 }}</a>
            </li>
            {% endif %}
            {% endfor%}
            <li class="page-item">
                <a class="page-link" href="
                {% if (data['metadata']['start']|int + data['metadata']['rows']|int) <= data['metadata']['number_of_hits']|int %}
                    .{{data['metadata']['url_without_pagination_parameters']}}&start={{data['metadata']['start']|int + data['metadata']['rows']|int }}&anzahl={{data['metadata']['rows']}}
                {% endif %}
                " aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                    <span class="sr-only">Next</span>
                </a>
            </li>
        </ul>
    </nav>
</div>

{% endblock %}
{% block scripts %}
{{ super() }}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
<script type="text/javascript">
    {% set count = namespace(value=0) %}
    {% for d in data['items'] %}
        {% set count.value = count.value + 1 %}
        {% if d['koordinaten_1'] %}
            var pelagiosMap = L.tileLayer('https://dh.gu.se/tiles/imperium/{z}/{x}/{y}.png');
            var map = L.map('map_canvas_{{count.value}}', {
                center: [{{d['koordinaten_1']}}],
                zoom: 4,
                zoomControl:false,
                layers: [pelagiosMap]
            });
            map.dragging.disable();
            map.touchZoom.disable();
            map.doubleClickZoom.disable();
            map.scrollWheelZoom.disable();
            map.keyboard.disable();
            var marker{{count.value}} = L.marker([{{d['koordinaten_1']}}]).addTo(map);
        {% endif %}
    {% endfor %}
</script>
{% endblock %}