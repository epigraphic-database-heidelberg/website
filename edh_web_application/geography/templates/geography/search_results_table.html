{% extends 'base.html' %}

{% block header %}
{% block title %}EDH: {{ title }} {% endblock %}
{% endblock %}

{% block app_content %}
<h1>{{ title }}</h1>
<h2>{{ subtitle }}</h2>
<p>{{_("The search for:")}}</p>
<p style="margin-left: 2rem;">{% for param in data['metadata']['query_params'] %}<strong>{{ _(param) }}</strong>: {{ data['metadata']['query_params'][param] }}<br />{% endfor %}</p>
<p>{{_("resulted in")}} {{number_of_hits}} {{_("hits.")}}</p>

<div class="search-filter" style="text-align:right">
    <button type="button" class="btn btn-info" id="view">{{_('view')}}: {{_('table')}}</button>
    <button type="button" class="btn btn-info" id="filter">{{_('filter')}}</button>
</div>


<div>
    <div class="table-responsive" style="100%; margin-bottom: 4rem;margin-top:3em;">
        <table id="tbl_findspot"  class="table-striped">
            <thead><th>ID</th><th>{{_('ancient find spot')}}</th><th>{{_('modern find spot')}}</th><th>{{_('find spot')}}</th><th>{{_('verw_bezirk')}}</th><th>{{_('country')}}</th></thead>
            <tbody>
            {% for d in data['items'] %}
            <tr>
                <td><a href="./edh/geographie/{{ d['id']}}">{{ d['id']}}</a></td>
                <td>{% if d['fo_antik'] %}{{d['fo_antik']}}{% else %}{% endif %}</td>
                <td>{% if d['fo_modern'] %}{{d['fo_modern']}}{% else %}{% endif %}</td>
                <td>{% if d['fundstelle'] %}{{d['fundstelle']}}{% else %}{% endif %}</td>
                <td>{% if d['verw_bezirk'] %}{{d['verw_bezirk']}}{% else %}{% endif %}</td>
                <td>{% if d['land'] %}{{d['land']}}{% else %}{% endif %}</td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<div id="dialog-view" title = "{{_('view')}}:">
    <ul>
    <li><a href=".{{data['metadata']['url_without_view_parameter']}}&start={{data['metadata']['start']}}&view=list">{{_('list')}}</a></li>
    <li><a href=".{{data['metadata']['url_without_view_parameter']}}&start={{data['metadata']['start']}}&view=table">{{_('table')}}</a></li>
    <li><a href=".{{data['metadata']['url_without_view_parameter']}}&start={{data['metadata']['start']}}&view=map">{{_('map')}}</a></li>
    </ul>
</div>
{% endblock %}
{% block scripts %}
{{ super() }}
<script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap.min.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
<link rel="stylesheet" href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap.min.css" />
<link rel="stylesheet" href=".{{url_for('geography.static', filename='css/geography.css')}}" />
<script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
<script src=".{{url_for('static', filename='js/copy2clipboard.js')}}"></script>
<script src=".{{url_for('geography.static', filename='js/bing.js')}}"></script>

<script>
    var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
            '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
            'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
        mbUrl = 'https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoid2VuYW11biIsImEiOiJCcUl0ZWRzIn0.zxs-a0hWY3La5kF4CWAVug';
    var streets  = L.tileLayer(mbUrl, {id: 'mapbox.streets', minZoom:3, attribution: mbAttr});
    var map = L.map('map_canvas', {
        center: [{{ data['polygon_center'] }}],
        zoom: 5,
        layers: [streets],
        zoomControl: false,
        preferCanvas: true,
        scrollWheelZoom: false
    });
    var baseLayers = {
        "Streets": streets
    };
    var geojson = {{ data['polygon'] | safe  }}
    var overlays = {};
    function polystyle(feature) {
        return {
            fillColor: '#1F6B3B',
            weight: 2,
            opacity: 1,
            color: '#f00',
            fillOpacity: 0.7
        };
    }
    L.geoJSON(geojson, {style: polystyle}).addTo(map);
</script>
<script>
$(document).ready(function() {
    $('#tbl_findspot').DataTable({
        pageLength: 20,
        language: {
            search: "{{ _("dtbl_search") }}",
            info: "{{ _("dtbl_info") }}",
            lengthMenu: "{{ _("dtbl_menu") }}",
            infoFiltered: "{{ _("dtbl_filter") }}",
            zeroRecords:  "{{ _("dtbl_zero") }}",
            paginate: {
                previous: "{{ _("dtbl_previous") }}",
                next: "{{ _("dtbl_next") }}"
            }
        }
    });
    $(function() {
        $( "#dialog-sort" ).dialog({
           autoOpen: false,
        });
        $( "#sort-by" ).click(function() {
           $( "#dialog-sort" ).dialog( "open" );
        });
        $( "#dialog-number" ).dialog({
           autoOpen: false,
        });
        $( "#hits-per-page" ).click(function() {
           $( "#dialog-number" ).dialog( "open" );
        });
        $( "#dialog-view" ).dialog({
           autoOpen: false,
        });
        $( "#view" ).click(function() {
           $( "#dialog-view" ).dialog( "open" );
        });
     });
} );
</script>
{% endblock %}